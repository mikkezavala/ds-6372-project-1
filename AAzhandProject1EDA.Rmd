---
title: "Project 1 EDA"
author: "Arman Azhand"
date: "2025-01-29"
output: html_document
---

```{r setup, include=FALSE}
library(ggplot2)
library(visdat)
library(tidyverse)
library(corrplot)
library(GGally)
library(car)
library(ggcorrplot)
library(plyr)
library(gridExtra)

knitr::opts_chunk$set(error=FALSE, warning=FALSE, message=FALSE)
```

# EDA

## Import Data
```{r}
hospitalData <- read.csv("./project_hospitals.csv", header = TRUE)
```

## Sanity check

### Summary of the Data Set
```{r}
summary(hospitalData)
```
### Finding empty values
```{r}
colSums(is.na(hospitalData))
```
#### Plot of missing data
```{r}
vis_miss(hospitalData)
```

Our data set `hospitalData` from the csv `HospitalDurations` contains 113 observations of 12 variables. We have no missing values for any variable, thus we do not need to impute for any observations. Out of the 12 variables, one of them is an identifier variable `ID`, and will not be used for predicting. The patient's length of stay `Lgth.of.Sty` is the variable we would like to predict for. Therefor, we have 10 potential explanatory variables and 1 variable we are trying to predict for.


### Visualizing Hospital Stay Distribution
```{r}
hist(cleanData$Lgth.of.Sty, xlab = "Length of Stay (Days)", main = "Histogram of Patient's Length of Stay")
```
We see some slight right skew for `Lgth.of.Sty`.


## Data Cleaning
```{r}
cleanData = hospitalData %>% select(-ID) # remove ID
cleanData$Region = as.factor(cleanData$Region) # convert Region from int to factor
cleanData$Med.Sc.Aff = as.factor(cleanData$Med.Sc.Aff) # convert Med.Sc.Aff from int to factor
summary(cleanData) # sanity check

# revalue factors
cleanData$Region = revalue(cleanData$Region, c("1" = "NE", "2" = "NC", "3" = "S", "4" = "W"))
cleanData$Med.Sc.Aff = revalue(cleanData$Med.Sc.Aff, c("1" = "Yes", "2" = "No"))
summary(cleanData) # sanity check

# labels for graphs
cleanDataLabels = c("Length of Stay",
                    "Age",
                    "Infection Risk",
                    "Routine culturing ratio",
                    "Routine chest X-ray ratio",
                    "Number of beds",
                    "Medical School Affiliation",
                    "Region",
                    "Average Daily census",
                    "Number of nurses",
                    "Available facilities")
```
## Initial Graphs
```{r}
# correlation matrix
cor_matrix = cor(cleanData %>% select(-Med.Sc.Aff, -Region)) # removed categorial variables

# correlation plot
# corrplot(cor_matrix, method = "color", type = "upper", tl.col = "black", tl.srt = 45)
ggcorrplot(cor_matrix, lab = TRUE)
```
Length of Stay correlated more strongly with: + Infection Risk, + Average Patients, + Number of Beds.

```{r}
pairs(cleanData, panel = function(x, y) {
  points(x, y, pch = 16, col = "blue")  # Scatter points
  abline(lm(y ~ x), col = "red")  # Add trend line
})
```

```{r}
ggpairs(cleanData, lower = list(continuous = wrap("smooth", method = "lm", color = "blue")))
```

### Categorical grouped by Categorical vs Length of Stay
```{r}
ggplot(data=cleanData,aes(x=Region,y=Lgth.of.Sty,colour=Med.Sc.Aff)) +
  geom_boxplot() +
  ggtitle("Boxplot of Region vs Patient Length of Stay", "Grouped by Medical School Affiliation")
ggplot(data=cleanData,aes(x=Med.Sc.Aff,y=Lgth.of.Sty,colour=Region)) +
  geom_boxplot() +
  ggtitle("Boxplot of Medical School Affiliation vs Patient Length of Stay", "Grouped by Region")
```
By looking at the distributions (via the boxplots), we can see that there are some differences between a patient's length of stay if we group by Region (or by Medical School Affiliation).

**If grouping by Medical school affiliation:  **
Length of stay between the regions is fairly similar on average if there is an affiliation for medical school, but the distributions are much more different between the regions. If there is no affiliation, then the distributions are a bit more similar, but the averages are different between each region.

**If grouping by Region:  **
Length of stay on average tends to be similar between the regions (being slightly less in the W and S regions) with NE having a wider distribution of length of stay. Interesting to note that medical school affiliation tends to have lower length of stay if the affiliation is none.

### Continuous grouped by Categorical vs Length of Stay

#### Grouped by Region
```{r}
for (i in c(2:6,9:11)) {
  tempPlot = ggplot(data=cleanData,aes(x=cleanData[,i],y=Lgth.of.Sty,colour=Region)) +
    geom_point() +
    geom_smooth() +
    ggtitle(paste0(cleanDataLabels[i]," vs Length of Stay"), "Grouped by Region") +
    xlab(cleanDataLabels[i]) +
    ylab("Length of Stay (Days)") +
    theme(legend.position = "none")
  print(tempPlot)
}
```
#### Grouped by Medical School Affiliation
```{r}
for (i in c(2:6,9:11)) {
  tempPlot = ggplot(data=cleanData,aes(x=cleanData[,i],y=Lgth.of.Sty,colour=Med.Sc.Aff)) +
    geom_point() +
    geom_smooth() +
    ggtitle(paste0(cleanDataLabels[i]," vs Length of Stay"), "Grouped by Medical School Affiliation") +
    xlab(cleanDataLabels[i]) +
    ylab("Length of Stay (Days)") +
    theme(legend.position = "none")
  print(tempPlot)
}
```

# Objective 1
```{r}
allVarsModel = lm(Lgth.of.Sty ~ ., data = cleanData)

par(mfrow = c(2,2))
plot(allVarsModel)
par(mfrow = c(1,1))

summary(allVarsModel)
```

## VIFs
```{r}
vif(allVarsModel)
```
Number of Beds and Average Patients have *extremely* high VIFs, suggesting high multicollinearity. This makes sense, as the more room a hospital has (number of beds) then the more patients they can have on average. Average number of full time nurses has potential collinearity as well, which also makes sense as a hospital with more beds will likely have more nursing staff to take care of the patients.
